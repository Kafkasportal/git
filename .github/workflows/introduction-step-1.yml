---
name: Step 1 - Create a branch

# This workflow triggers when a branch is created
'on':
  create:
  push:
    branches:
      - my-first-branch
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  check-branch:
    name: Check if branch was created
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Check if my-first-branch exists
        id: check_branch
        run: |
          if git rev-parse --verify origin/my-first-branch >/dev/null 2>&1
          then
            echo "branch_exists=true" >> $GITHUB_OUTPUT
            echo "âœ… Branch 'my-first-branch' was created successfully!"
          else
            echo "branch_exists=false" >> $GITHUB_OUTPUT
            echo "âŒ Branch 'my-first-branch' does not exist yet."
          fi

      - name: Update README to Step 2
        if: steps.check_branch.outputs.branch_exists == 'true'
        run: |
          cat > .github/README.md << 'EOF'
          # Introduction to GitHub

          Get started using GitHub in less than an hour.

          ## Step 2: Commit a file

          _You created a branch! :tada:_

          Creating a branch allows you to edit your project without changing
          the `main` branch. Now that you have a branch, it's time to create
          a file and make your first commit!

          **What is a commit?**: A commit is a set of changes to the files
          and folders in your project. A commit exists in a branch.
          For more information, see ["About commits"](https://docs.github.com/en/pull-requests/committing-changes-to-your-project/creating-and-editing-commits/about-commits).

          ### âŒ¨ï¸ Activity: Your first commit

          The following steps will guide you through the process of committing
          a change on GitHub. A commit records changes in renaming, changing
          content within, creating a new file, and any other changes made to
          your project. For this exercise, committing a change requires first
          adding a new file to your new branch.

          1. On the **< > Code** tab in the header menu of your repository,
             make sure you're on your new branch `my-first-branch`.

          2. Select the **Add file** drop-down and click **Create new file**.

             ![Create new file](https://user-images.githubusercontent.com/1221423/213036819-0f29f3e6-8e1f-4c9d-8e1f-8e1f8e1f8e1f.png)

          3. In the **Name your file...** field, enter `PROFILE.md`.

          4. In the **Edit new file** area, copy the following content to
             your file:

             ```
             Welcome to my GitHub profile!
             ```

          5. For commits, you can enter a short commit message that describes
             what changes you made. This message helps others know what's
             included in your commit. GitHub offers a simple default message,
             but let's change it slightly for practice. First, enter
             `Add PROFILE.md` in the first text-entry field titled
             "Commit new file". Then, if you want to confirm what your
             screen should look like, expand the dropdown below.

          6. In this lesson, we'll ignore the other fields and click
             **Commit new file**.

          7. Move on to Step 3!

          Wait about 20 seconds then refresh this page (the one you're
          following instructions from). GitHub Actions will automatically
          update to the next step.

          ---

          **Note**: This is an interactive GitHub tutorial. Complete the
          activity above to proceed to the next step.
          EOF

          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git config --global user.name "github-actions[bot]"
          git add .github/README.md
          git commit -m "Update to Step 2"
          git push

      - name: Congratulations
        if: steps.check_branch.outputs.branch_exists == 'true'
        run: |
          echo "ðŸŽ‰ Congratulations! You've successfully completed Step 1!"
          echo "The tutorial has been updated to Step 2."
